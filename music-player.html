<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéß Jeffery Music Room</title>
  <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>

  <style>
    :root {
      --bg-color: #f0f2f5;
      --text-color: #222;
      --card-bg: rgba(255, 255, 255, 0.5);
      --button-bg: rgba(0, 122, 255, 0.7);
      --button-hover: linear-gradient(45deg, rgba(111,177,252,0.8), rgba(67,100,247,0.8));
      --header-color: #fdfdfd;
    }

    body.dark-mode {
      --bg-color: #1c1c1e;
      --text-color: #f5f5f7;
      --card-bg: rgba(44, 44, 46, 0.75);
      --button-bg: rgba(100, 100, 255, 0.7);
      --button-hover: linear-gradient(45deg, rgba(111,177,252,0.3), rgba(67,100,247,0.6));
      --header-color: #ffffff;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", sans-serif;
      background: url("main-background.jpg") no-repeat center center fixed;
      background-size: cover;
      color: var(--text-color);
      transition: 0.3s;
      min-height: 100vh;
    }

    #particles-js {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
    }

    header {
      color: var(--header-color);
      font-size: 28px;
      margin-top: 30px;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
      text-align: center;
    }

    .toggle-button {
      position: fixed;
      top: 20px; right: 20px;
      padding: 10px;
      background: var(--button-bg);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10;
    }

    .container {
      max-width: 1100px;
      margin: 40px auto;
      padding: 24px;
      background: var(--card-bg);
      border-radius: 20px;
      backdrop-filter: blur(16px);
    }

    .player-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
    }

    .sidebar-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .upload-label {
      display: inline-flex;
      padding: 10px 14px;
      background: var(--button-bg);
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 6px;
    }

    #file-input { display: none; }

    .playlist {
      list-style: none;
      padding: 0;
      max-height: 500px;
      overflow-y: auto;
    }

    .playlist-item {
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      transition: 0.2s;
    }

    .playlist-item.active {
      background: rgba(0,122,255,0.18);
      border-left: 4px solid rgba(0,122,255,0.9);
    }

    .now-playing {
      padding: 20px;
      border-radius: 16px;
      background: rgba(255,255,255,0.6);
      display: flex;
      gap: 20px;
    }

    .cover {
      width: 120px; height: 120px;
      border-radius: 24px;
      background: #999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }

    .controls {
      margin-top: 10px;
      padding: 18px;
      background: rgba(255,255,255,0.6);
      border-radius: 16px;
    }

    .control-buttons {
      display: flex;
      justify-content: center;
      gap: 18px;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: rgba(0,0,0,0.1);
      border: none;
      cursor: pointer;
      font-size: 18px;
    }

    .icon-btn.main {
      width: 54px; height: 54px;
      background: var(--button-bg);
      color: #fff;
      font-size: 24px;
    }

    .progress-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
    }

    .progress-bar {
      flex: 1;
    }

  </style>
</head>

<body>
  <div id="particles-js"></div>

  <header>üéß Jeffery Music Room</header>
  <button class="toggle-button" onclick="toggleDarkMode()">üåô</button>

  <div class="container">
    <div class="player-layout">
      <!-- Â∑¶‰æßÊí≠ÊîæÂàóË°® -->
      <aside>
        <div class="sidebar-title">Êí≠ÊîæÂàóË°®</div>

        <!-- ‰∏ä‰º†Êú¨Âú∞Ê≠åÊõ≤ -->
        <label class="upload-label">
          ‚¨Ü ‰∏ä‰º†Èü≥‰πê
          <input id="file-input" type="file" accept="audio/*" multiple />
        </label>

        <ul id="playlist" class="playlist"></ul>
      </aside>

      <!-- Âè≥‰æßÊí≠ÊîæÁïåÈù¢ -->
      <main class="main-panel">
        <section class="now-playing">
          <div class="cover">üéµ</div>
          <div>
            <h2 id="track-title">ËØ∑ÈÄâÊã©Èü≥‰πê</h2>
            <p id="track-artist">Jeffery</p>
            <p id="track-extra">Êí≠ÊîæÂô®Â∑≤ÂáÜÂ§áÂ∞±Áª™</p>
          </div>
        </section>

        <section class="controls">
          <div class="control-buttons">
            <button class="icon-btn" id="prev-btn">‚èÆ</button>
            <button class="icon-btn main" id="play-btn">‚ñ∂Ô∏è</button>
            <button class="icon-btn" id="next-btn">‚è≠</button>
          </div>

          <div class="progress-row">
            <span id="current-time">00:00</span>
            <input type="range" id="progress" min="0" max="100" value="0" class="progress-bar">
            <span id="total-time">00:00</span>
          </div>
        </section>
      </main>
    </div>
  </div>

<script>
  // ÊöóËâ≤Ê®°Âºè
  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("dark-mode",
      document.body.classList.contains("dark-mode") ? "1" : "0");
  }
  if (localStorage.getItem("dark-mode") === "1") {
    document.body.classList.add("dark-mode");
  }

  // === Áªü‰∏ÄÊí≠ÊîæÂô®ÔºöÊúçÂä°Âô® + Êú¨Âú∞ ===
  const audio = new Audio();
  let tracks = [
    {
      name: "20251129",
      fileName: "20251129.mp3",
      url: "https://apple-jeffery.github.io/20251129.mp3",
      type: "server"
    }
  ];

  let currentIndex = 0;

  const playlistEl = document.getElementById("playlist");
  const trackTitleEl = document.getElementById("track-title");
  const trackArtistEl = document.getElementById("track-artist");
  const trackExtraEl = document.getElementById("track-extra");
  const playBtn = document.getElementById("play-btn");
  const prevBtn = document.getElementById("prev-btn");
  const nextBtn = document.getElementById("next-btn");
  const progressEl = document.getElementById("progress");
  const currentTimeEl = document.getElementById("current-time");
  const totalTimeEl = document.getElementById("total-time");

  // Ê∏≤ÊüìÊí≠ÊîæÂàóË°®
  function renderPlaylist() {
    playlistEl.innerHTML = "";
    tracks.forEach((t, i) => {
      const li = document.createElement("li");
      li.className = "playlist-item" + (i === currentIndex ? " active" : "");
      li.innerHTML = `<span>${t.name}</span><span>${t.type === "server" ? "‰∫ëÁ´Ø" : "Êú¨Âú∞"}</span>`;
      li.onclick = () => playTrack(i);
      playlistEl.appendChild(li);
    });
  }

  // Êí≠Êîæ
  function playTrack(i) {
    currentIndex = i;
    const t = tracks[i];

    audio.src = t.url;
    audio.play();

    trackTitleEl.textContent = t.name;
    trackArtistEl.textContent = t.fileName;
    trackExtraEl.textContent = t.type === "server" ? "Êù•Ëá™ Jeffery ‰∫ëÁ´ØÈü≥‰πê" : "Êú¨Âú∞Êñá‰ª∂";

    updatePlaylist();
    updatePlayIcon();
  }

  function updatePlaylist() {
    [...playlistEl.children].forEach((li, idx) => {
      li.classList.toggle("active", idx === currentIndex);
    });
  }

  function updatePlayIcon() {
    playBtn.textContent = audio.paused ? "‚ñ∂Ô∏è" : "‚è∏";
  }

  playBtn.onclick = () => {
    audio.paused ? audio.play() : audio.pause();
    updatePlayIcon();
  };

  prevBtn.onclick = () => playTrack((currentIndex - 1 + tracks.length) % tracks.length);
  nextBtn.onclick = () => playTrack((currentIndex + 1) % tracks.length);

  // ËøõÂ∫¶Êù°
  audio.ontimeupdate = () => {
    if (!audio.duration) return;
    progressEl.value = (audio.currentTime / audio.duration) * 100;
    currentTimeEl.textContent = formatTime(audio.currentTime);
    totalTimeEl.textContent = formatTime(audio.duration);
  };

  progressEl.oninput = () => {
    audio.currentTime = (progressEl.value / 100) * audio.duration;
  };

  function formatTime(s) {
    s = Math.floor(s);
    return String(Math.floor(s / 60)).padStart(2,"0") + ":" + String(s % 60).padStart(2,"0");
  }

  // Êú¨Âú∞‰∏ä‰º†ÈÄªËæë
  document.getElementById("file-input").addEventListener("change", e => {
    const files = [...e.target.files];
    files.forEach(f => {
      tracks.push({
        name: f.name.replace(/\.[^/.]+$/, ""),
        fileName: f.name,
        url: URL.createObjectURL(f),
        type: "local"
      });
    });
    renderPlaylist();
  });

  renderPlaylist();
</script>

</body>
</html>
